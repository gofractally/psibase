# Plugin Permissions and Trust Assertions Report

This report lists all publicly-exposed functions for each plugin in the Psibase system, along with their trust-related assertions. Functions with no assertions are explicitly listed as such for completeness.

## Analysis Methodology

- **Publicly-exposed functions**: Functions defined in WIT interface files that can be called by other services or frontend applications
- **Trust assertions**: Authorization checks that restrict function access based on caller identity, trust levels, or whitelists
- **Assertion types**:
  - **Trust level assertions**: Using `psibase::define_trust!` macro with `assert_authorized()` calls
  - **Whitelist assertions**: Using `assert_authorized_with_whitelist()` or hardcoded whitelist checks
  - **Caller checks**: Direct checks on `get_sender()`, `get_active_app()`, etc.
  - **Admin checks**: Service-specific admin authorization patterns

## Plugin Functions and Trust Assertions

| Plugin                                                                                  | Function                      | Trust Assertions                                                             | Proposed                                                                                                                                 |
| --------------------------------------------------------------------------------------- | ----------------------------- | ---------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| **crypto**<br/>(Uses `psibase::define_trust!` with None/Low/High trust levels)          | `generate-unmanaged-keypair`  | None                                                                         |
|                                                                                         | `pub-from-priv`               | None                                                                         |
|                                                                                         | `to-der`                      | None                                                                         |
|                                                                                         | `sign`                        | High; assert_authorized_whitelist: ["transact", "auth-sig"]                  |
|                                                                                         | `sign-explicit`               | Low; assert_authorized_whitelist: ["auth-sig", "auth-invite"]                | None (no whitelist)                                                                                                                      |
|                                                                                         | `import-key`                  | Low; assert_authorized_whitelist: ["x-admin", "invite", "auth-sig"]          | None                                                                                                                   |
| **auth**<br/>(Caller-based whitelisting)                                                | `set-logged-in-user`          | N/A; check_caller(&["accounts"])                                             | All Max --> no Trust definitinos; assert(get_caller() == "accounts")("accounts")                                                                                                               |
|                                                                                         | `log-out-user`                | N/A; check_caller(&["accounts"])                                             | assert("accounts")                                                                                                               |
|                                                                                         | `get-active-query-token`      | N/A; check_caller(&["host", "supervisor"])                                   | assert("host", "supervisor")                                                                                                     |
| **types**<br/>(No trust assertions)                                                     | `new`                         | N/A                                                                          | -- No trust definitions --                                                                                                                                     |
|                                                                                         | `get-service`                 | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-plugin`                  | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-intf`                    | N/A                                                                          | None                                                                                                                                     |
| **common**<br/>(Caller-based whitelisting)                                              | `server::post`                        | N/A; check_caller(&["host"])                                                 | -- No trust defintions needed (all None or Max) --                |
|                                                                                         | `post-graphql-get-json`       | N/A                                                                          | None                                                                                                                                    |
|                                                                                         | `admin::post`                        | N/A                                                                          | assert("host")                                                                                                                                    |
|                                                                                         | `get-json`                    | N/A                                                                          | None                                                                                                                                    |
|                                                                                         | `get-sender`                  | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-receiver`                | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-app-url`                 | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-active-app`              | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `clear-buffers`               | N/A; check_caller(&["transact"])                                             | assert("transact")                                                                                                                    |
|                                                                                         | `flush-transactional-data`    | N/A; check_caller(&["transact"])                                             | assert("transact")                                                                                                                    |
| **prompt**<br/>(Caller-based checks)                                                    | `get-active-prompt`           | N/A; assert_eq!(get_sender(), "supervisor")                                  | -- No trust definitions -- MAX; assert("supervisor")                                                                                                             |
|                                                                                         | `prompt`                      | N/A                                                                          | None                                            |
|                                                                                         | `get-context`                 | N/A                                                                          | check that context `prompt_app` == getSender().                                                                                                                |
| **Supervisor**<br/>(No trust assertions - only bindings.rs present)                     |                               | N/A                                                                          | -- no trust definitions --                                                                                                              |
| **Accounts**<br/>(Mixed - admin checks, hardcoded restrictions, and whitelist patterns) | api::`is-logged-in`                | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-account`                 | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `set-auth-service`            | N/A; Client::get_sender() != "homepage"                                      | High; whitelist("homepage")                                                                                                           |
|                                                                                         | `get-current-user`            | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | admin::`login-direct`                | N/A; assert_caller_admin                                                     | MAX; whitelist("accounts")                   |
|                                                                                         | `decode-connection-token`     | N/A; assert_caller_admin                                                     | None                                                                                                                                  |
|                                                                                         | `get-connected-apps`          | N/A; assert(caller == "homepage")                                            | High; whitelist("homepage")                                                    |
|                                                                                         | `import-account`              | N/A; assert_caller_admin                                                     | MAX; whitelist("accounts")                                                                                                                                  |
|                                                                                         | `get-all-accounts`            | N/A; assert_caller_admin                                                     | MAX; whitelist("accounts", "supervisor") |
|                                                                                         | `get-auth-services`           | N/A; assert(Client::get_sender() == "supervisor")                            | MAX; whitelist("supervisor")                                                                                                             |
|                                                                                         | active_app::`login`           | MAX; top_level_app                           | leave as is -- top_level + (sometimes) supervisor                                                                                                               |
|                                                                                         | `logout`           | top_level_app or supervisor                            |                                                                                                                |
|                                                                                         | `get-connected-accounts`           | top_level_app or supervisor                            |                                                                                                               |
|                                                                                         | `create-connection-token`           | top_level_app                            |                                                                                                               |
| **AuthSig**<br/>(Uses `psibase::define_trust!` with None/Low/High trust levels)         | `generate-unmanaged-keypair`  | None                                                                         | None
|                                                                                         | `pub-from-priv`               | None                                                                         | None
|                                                                                         | `to-der`                      | None                                                                         | None
|                                                                                         | `sign`                        | High; assert_authorized_whitelist: ["transact"]                              | High
|                                                                                         | `sign-explicit`               | Low; assert_authorized_whitelist: ["auth-invite"]                            | None                                                                                                                                     |
|                                                                                         | `import-key`                  | Low; assert_authorized_whitelist: ["accounts", "x-admin", "invite"]          | Low
|                                                                                         | `set-key`                     | High                                                                         | High
| **Transact**<br/>(Supervisor-only access and hardcoded whitelists)                      | `hook-action-auth`            | N/A                                                                          | None
|                                                                                         | `hook-actions-sender`         | N/A; hardcoded whitelist: ["staged-tx", "invite"]                            | High; whitelist("staged-tx", "invite")                                                                                                         |
|                                                                                         | `unhook-actions-sender`       | N/A                                                                          | None
|                                                                                         | `hook-tx-transform-label`     | N/A; hardcoded whitelist: ["staged-tx"]                                      | MAX; whitelist("staged-tx")                                                                                                                   |
|                                                                                         | `add-action-to-transaction`   | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `set-snapshot-time`           | N/A                                                                          | MAX; whitelist("config")                                                                                                                                      |
|                                                                                         | `start-tx`                    | N/A; assert_from_supervisor()                                                | MAX; whitelist("supervisor")                                                                                                            |
|                                                                                         | `finish-tx`                   | N/A; assert_from_supervisor()                                                | MAX; whitelist("supervisor")                                                                                                             |
|                                                                                         | `get-query-token`             | N/A; assert(Client::get_sender() == "host")                                  | MAX; whitelist("host")                                                                                                                   |
| **Permissions**<br/>(Admin checks and app-based authorization)                          | `get-context`                 | N/A; assert_admin()                                                          | no trust definitions (can't)                                                                                                                          |
|                                                                                         | `approve`                     | N/A; assert_admin()                                                          |                                                                                                                           |
|                                                                                         | `set-allowed-callers`         | N/A; assert_eq!(get_sender(), get_active_app())                              |                                                                                                                                   |
|                                                                                         | `is-authorized`               | N/A; Complex authorization logic (trust levels, whitelists, user validation) |                                                                                                                         |
| **Evaluations**<br/>(Owner/service-based access control)                                | admin intf | N/A                | Medium; whitelist(get_receiver())
|                                                                                         | user intf | N/A; check_app_origin() - allows owner or evaluations service                | High; check_app_origin replaced with whitelist(<Eval owner>, "evaluations")
| **Tokens**<br/>(Sender-based authorization for token operations)                        | issuer::`create`                      | N/A                               | Medium                                                                                                                                   |
|                                                                                         | `recall`                      |  N/A                             | High                                                                                                                                   |
|                                                                                         | `mint`                      |  N/A                              | High                                                                                                                                   |
|                                                                                         | `map-symbol`                      |  N/A                              | High                                                                                                                                   |
|                                                                                         | `enable-token-untransferrable`                      |  N/A                              | High                                                                                                                                   |
|                                                                                         | `enable-token-unrecallable`                      |  N/A                              | High                                                                                                                                   |
|                                                                                         | user::`credit`                      | N/A                               | High; [for user:: functions] whitelist("homepage")                                                                                                                                   |
|                                                                                         | `uncredit`                      | N/A                               | High                                                                                                                                   |
|                                                                                         | `debit`                      | N/A                               | High                                                                                                                                   |
|                                                                                         | `reject`                      | N/A                               | High                                                                                                                                   |
|                                                                                         | `burn`                      | N/A                               | High                                                                                                                                   |
|                                                                                         | user-config::`enable-user-manual-debit`                      |                               | Medium; [for user-config:: functions] whitelist("homepage")                                                                                                                                   |
|                                                                                         | `enable-user-keep-zero-balances`                      |                               | Medium                                                                                                                                   |
|                                                                                         | `enable-balance-manual-debit`                      |                               | Medium                                                                                                                                   |
|                                                                                         | `enable-balance-keep-zero-balances`                      |                               | Medium                                                                                                                                   |
|                                                                                         | `del-balance-config`                      |                               | Medium                                                                                                                                   |
|                                                                                         | helpers::`decimal-to-u64`                      |                               | None                                                                                                                                   |
|                                                                                         | `u64-to-decimal`                      |                               | None                                                                                                                                   |
| **AuthAny**<br/>(No trust assertions)                                                   | `on_user_auth_claim`          | N/A                                                                          | -- no trust definitions -- |
|                                                                                         | `on_user_auth_proof`          | N/A                                                                          |
| **AuthDelegate**<br/>(No trust assertions)                                              | `set-owner`                   | N/A                                                                          | High; whitelist("workshop", receiver)                                                                                                               |
|                                                                                         | `new-account`                 | N/A                                                                          | Medium                                                                                                              |
| **Producers**<br/>(No trust assertions)                                                 | `set-cft-consensus`           | N/A                                                                          | --no trust definitions -- assert("config")                                                                                 |
|                                                                                         | `set-bft-consensus`           | N/A                                                                          | assert("config")
|                                                                                         | `set-producers`               | N/A                                                                          | assert("config")
| **SetCode**<br/>(No trust assertions)                                                   | `set-service-code`            | N/A                                                                          | High; whitelist("workshop")                                                                                            |
|                                                                                         | `stage-service-code`          | N/A                                                                          | High; whitelist("workshop", "packages")                                                                                                                                        |
| **StagedTx**<br/>(No trust assertions)                                                  | `set-propose-latch`           | N/A                                                                          | None
|                                                                                         | `propose`                     | N/A                                                                          | MAX; whitelist("packages")
|                                                                                         | `remove`                      | N/A                                                                          | None
|                                                                                         | `accept`                      | N/A                                                                          | High: whitelist("config", "workshop")
|                                                                                         | `reject`                      | N/A                                                                          | High: whitelist("config", "workshop")
|                                                                                         | `execute`                     | N/A                                                                          | None
| **HttpServer**<br/>(C++ service - no plugin functions)                                  | No plugin functions           |
| **CpuLimit**<br/>(C++ service - no plugin functions)                                    | No plugin functions           |
| **VerifySig**<br/>(C++ service - no plugin functions)                                   | No plugin functions           |
| **Aes**<br/>(No trust assertions)                                                       | `encrypt (with-password)`     | None                                                                         | No trust definition needed.                                                                                                              |
|                                                                                         | `decrypt (with-password)`     | None                                                                         |
|                                                                                         | `encrypt (with-key)`          | None                                                                         |
|                                                                                         | `decrypt (with-key)`          | None                                                                         |
| **Base64**<br/>(No trust assertions)                                                    | `encode (url)`                | N/A                                                                          | No trust definition needed                                                                                                               |
|                                                                                         | `decode (url)`                | N/A                                                                          |
|                                                                                         | `encode (standard)`           | N/A                                                                          |
|                                                                                         | `decode (standard)`           | N/A                                                                          |
| **Branding**<br/>(No trust assertions)                                                  | `set-network-name`            | N/A                                                                          | -- no trust definitions -- assert("config")                                                                                                                 |
|                                                                                         | `set-logo`                    | N/A                                                                          | assert("config")                                                                                                                 |
|                                                                                         | `get-network-name`            | N/A                                                                          | None                                                                                                                                     |
| **BrotliCodec**<br/>(No trust assertions)                                               | `compress`                    | N/A                                                                          | No trust definition needed                                                                                                               |
|                                                                                         | `decompress`                  | N/A                                                                          |
| **Chainmail**<br/>(No trust assertions)                                                 | `get-msgs`                    | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-archived-msgs`           | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-saved-msgs`              | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `send`                        | N/A                                                                          | High; whitelist(receiver)                                                                                                                |
|                                                                                         | `archive`                     | N/A                                                                          | Medium: whitelist("workshop")                                                                                                                                   |
|                                                                                         | `save`                        | N/A                                                                          | Medium: whitelist("workshop")                                                                                                                                   |
| **ClientData**<br/>(No trust assertions)                                                | `get`                         | N/A                                                                          | None                                                                                                       |
|                                                                                         | `set`                         | N/A                                                                          |                                                                                                        |
|                                                                                         | `delete`                      | N/A                                                                          |                                                                                                        |
| **Config**<br/>TODO: consider the plugin fns called by these                            | `upload-network-logo`         | N/A                                                                          | MAX                                                                                                                                      |
|                                                                                         | `set-network-name`            | N/A                                                                          | MAX                                                                                                                                      |
|                                                                                         | `set-account-sources`         | N/A                                                                          | MAX                                                                                                                                      |
|                                                                                         | `set-snapshot-time`           | N/A                                                                          | MAX                                                                                                                                      |
|                                                                                         | `set-cft-consensus`           | N/A                                                                          | MAX                                                                                                                                      |
|                                                                                         | `set-bft-consensus`           | N/A                                                                          | MAX                                                                                                                                      |
|                                                                                         | `set-producers`               | N/A                                                                          | MAX                                                                                                                                      |
| **Fractals**<br/>(No trust assertions)<br/>TODO: revisit after John's PRs are merged                                                  | `create-fractal`              | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `set-schedule`                | N/A                                                                          | High                                                                                                                                     |
|                                                                                         | `start`                       | N/A                                                                          | High                                                                                                                                     |
|                                                                                         | `close-eval`                  | N/A                                                                          | High                                                                                                                                     |
|                                                                                         | `join`                        | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `attest`                      | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `propose`                     | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `register`                    | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `unregister`                  | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `get-group-users`             | N/A                                                                          | None                                                                                                                                     |
|                                                                                         | `get-proposal`                | N/A                                                                          | None                                                                                                                                     |
| **Identity**<br/>(No trust assertions)                                                  | `attest-identity-claim`       | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `summary`                     | N/A                                                                          | None                                                                                                                                     |
| **Invite**<br/>(No trust assertions); TODO: update to include James' recent updates                                                    | `generate-invite`             | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `delete-invite`               | N/A                                                                          | Medium?                                                                                                                                  |
|                                                                                         | `decode-invite`               | N/A                                                                          | None?                                                                                                                                    |
|                                                                                         | `accept-with-new-account`     | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `accept`                      | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `reject`                      | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `deserialize`                 | N/A                                                                          | None                                                                                                                                     |
| **Kdf**<br/>(No trust assertions)                                                       | `derive-key`                  | N/A                                                                          | None                                                                                                                                     |
| **Nft**<br/>(C++ service - no plugin functions)                                         | No plugin functions           |
| **Nop**<br/>(C++ service - no plugin functions)                                         | No plugin functions           |
| **Packages**<br/>(No trust assertions)                                                  | `resolve`                     | N/A                                                                          | sender == "config" and get_receiver (for resolve, build, propose, push-data) EXCEPT set-account-sources (only "config") |
|                                                                                         | `build-transactions`          | N/A                                                                          |                                                                                                                                        |
|                                                                                         | `propose-install`             | N/A                                                                          |                                                                                                                                   |
|                                                                                         | `set-account-sources`         | N/A                                                                          |                                                                                                               |
|                                                                                         | `push-data`                   | sender == "config"                                                           |                                                                                                                                   |
| **Profiles**<br/>(No trust assertions)                                                  | `set` (contacts)              | N/A                                                                          | Low; whitelist("homepage")                                                                                                                                      |
|                                                                                         | `remove` (contacts)           | N/A                                                                          | Low; whitelist("homepage")                                                                                                                                      |
|                                                                                         | `get` (contacts)              | N/A                                                                          | High; whitelist("homepage") |
|                                                                                         | `set-profile` (api)           | N/A                                                                          | Medium; whitelist("homepage")                                                                                                                                   |
|                                                                                         | `upload-avatar` (api)         | N/A                                                                          | Medium; whitelist("homepage")                                                                                                                                   |
|                                                                                         | `remove-avatar` (api)         | N/A                                                                          | Medium; whitelist("homepage")                                                                                                                                     |
| **Registry**<br/>(No trust assertions)                                                  | `set-metadata`                | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `publish`                     | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `unpublish`                   | N/A                                                                          | High                                                                                                                                   |
| **SimpleService**<br/>(C++ service - no plugin functions)                               | No plugin functions           |
| **Sites**<br/>(No trust assertions)                                                     | `upload`                      | N/A                                                                          | High; [everything should] whitelist("workshop")                                                                                                                                   |
|                                                                                         | `upload-encoded`              | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `upload-tree`                 | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `remove`                      | N/A                                                                          | High                                      |
|                                                                                         | `enable-spa`                  | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `set-csp`                     | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `delete-csp`                  | N/A                                                                          | High                                                                                                                                |
|                                                                                         | `set-cache-mode`              | N/A                                                                          | Medium                                                                                                                                   |
| **Subgroups**<br/>(C++ service - no plugin functions)                                   | No plugin functions           |
| **TokenStream**<br/>(Uses `psibase::define_trust!` with Low/Medium/High trust levels)   | `create`                      | Medium                                                                       | Medium                                                                                                                                   |
|                                                                                         | `deposit`                     | High                                                                         | High                                                                                                                                     |
|                                                                                         | `claim`                       | High                                                                         | High                                                                                                                                     |
|                                                                                         | `delete`                      | High                                                                         | High                                                                                                                               |
| **WebCrypto**<br/>(No trust assertions)                                                 | `sign`                        | N/A                                                                          | assert(sender == "supervisor")                                                                                                                                     |
|                                                                                         | `sign-explicit`               | N/A                                                                          | assert(sender == "supervisor")                                                                                                                                     |
|                                                                                         | `import-key`                  | N/A                                                                          | assert(sender == "supervisor")                                                                                                                                     |
| **Workshop**<br/>(No trust assertions)                                                  | `create-app`                  | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `set-app-metadata`            | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `publish-app`                 | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `unpublish-app`               | N/A                                                                          | High                                                                                                                                |
|                                                                                         | `upload`                      | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `upload-tree`                 | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `enable-spa`                  | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `set-csp`                     | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `delete-csp`                  | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `remove`                      | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `set-cache-mode`              | N/A                                                                          | Medium                                                                                                                                   |
|                                                                                         | `set-service-code`            | N/A                                                                          | High                                                                                                                                   |
|                                                                                         | `send`                        | N/A                                                                          | MAX                                                                                                              |
|                                                                                         | `archive`                     | N/A                                                                          | MAX                                                                                                                                   |
|                                                                                         | `save`                        | N/A                                                                          | MAX                                                                                                                                   |
| **XAdmin**<br/>(No plugin interface)                                                    | No plugin functions           |

## Summary

- **Plugins using `define_trust!` framework**: 3 plugins use the formal trust level system:
  - **crypto** (Host): None/Low/High trust levels
  - **AuthSig** (System): None/Low/High trust levels
  - **TokenStream** (User): Low/Medium/High trust levels
- **Plugins with alternative auth mechanisms**: Several plugins implement custom authorization checks:
  - **auth**, **common**, **prompt**, **transact**: Use check_caller() or sender checks (marked as "N/A; <check description>")
  - **Accounts**: Uses assert_caller_admin and hardcoded caller checks
  - **Permissions**: Uses assert_admin() and app-based checks
  - **Tokens**, **Evaluations**: Use table-level or service-based authorization
- **Plugins with no authorization**: Majority of user plugins have no explicit authorization checks (marked as "N/A")
- **C++ services**: Several plugins are C++ services without plugin interfaces (Nft, Nop, SimpleService, Subgroups, XAdmin)
- **Total plugins analyzed**: 40+ plugins across system and user packages
- **Functions audited**: Each publicly-exposed function is listed individually with its specific trust level or authorization mechanism

### Trust Level Notation

- **None/Low/Medium/High**: Function uses `assert_authorized()` with the specified trust level from `define_trust!` macro
- **[Level]; assert_authorized_whitelist: [...]**: Function uses `assert_authorized_with_whitelist()` with specified trust level and whitelist
- **N/A**: Function does not use the `assert_authorized*()` framework
- **N/A; [description]**: Function has custom authorization checks but doesn't use the trust framework

This report provides a comprehensive audit foundation with all publicly-exposed functions individually listed and their authorization mechanisms clearly distinguished.
