<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>App - Parent</title>

    <script src="https://unpkg.com/penpal@^6/dist/penpal.min.js"></script>

    <script>
      const iframe = document.createElement("iframe");
      iframe.src = "https://supervisor-sys.psibase.127.0.0.1.sslip.io:8080";
      iframe.style.display = "none";

      if (
        document.readyState === "complete" ||
        document.readyState === "interactive"
      ) {
        document.body.appendChild(iframe);
      } else {
        document.addEventListener("DOMContentLoaded", () => {
          document.body.appendChild(iframe);
        });
      }

      const connection = Penpal.connectToChild({
        iframe,
        methods: {
          add: (a, b) => a + b,
        },
      });

      connection.promise.then((child) => {
        child.multiply(2, 6).then((total) => console.log(total));
        child.divide(12, 4).then((total) => console.log(total));
      });

      console.log("this is the app running!");
      console.log(
        Penpal.connectToParent,
        "this should be the parent connection???"
      );
    </script>
  </head>
  <body>
    <h1>This is the app - parent</h1>
  </body>
</html>
